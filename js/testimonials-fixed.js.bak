// Testimonials Animations
document.addEventListener('DOMContentLoaded', function () {
    // Initialize animations for the testimonial section
    initializeTestimonialAnimations();

    // Add event listeners to the scroll arrows
    setupTestimonialScrolling();

    // No longer using touch and drag scrolling - using only arrows
});

// Function to initialize animations for testimonial elements
function initializeTestimonialAnimations() {
    // For reveal animations with better performance options
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('active');

                // Remove observer once animation is applied
                observer.unobserve(entry.target);
            }
        });
    }, {
        threshold: 0.15,
        rootMargin: '-20px'
    });

    // Enhanced scroll effects observer with higher quality animations
    const enhancedObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                // Add an enhanced animation class
                entry.target.classList.add('active');
                entry.target.classList.add('enhanced-animation');

                // Remove observer once animation is applied
                enhancedObserver.unobserve(entry.target);
            }
        });
    }, {
        // Use a higher threshold and adjusted margins for a more precise trigger
        threshold: 0.25,
        rootMargin: '-10px 0px -10px 0px'
    });

    // Apply special animations to title and description
    const sectionTitle = document.querySelector('.alumni-testimonials-section .section-title');
    const sectionDesc = document.querySelector('.alumni-testimonials-section .section-description');

    if (sectionTitle) {
        sectionTitle.classList.add('reveal-special');
        enhancedObserver.observe(sectionTitle);
    }

    if (sectionDesc) {
        sectionDesc.classList.add('reveal-special');
        sectionDesc.style.transitionDelay = '0.15s';
        enhancedObserver.observe(sectionDesc);
    }

    // Observe testimonial section elements
    document.querySelectorAll('.alumni-testimonials-section, .reveal, .reveal-left, .reveal-right').forEach(element => {
        observer.observe(element);
    });

    // Observe individual testimonial cards for animation with improved performance
    document.querySelectorAll('.alumni-testimonial-card').forEach((element, index) => {
        // Add will-change property for better performance
        element.style.willChange = 'opacity, transform';

        // Add a small incremental delay based on index for staggered appearance
        element.style.transitionDelay = `${0.2 + (index * 0.1)}s`;

        enhancedObserver.observe(element);
    });

    // Remove will-change after animations complete to free up resources
    setTimeout(() => {
        document.querySelectorAll('.alumni-testimonial-card').forEach(element => {
            element.style.willChange = 'auto';
        });
    }, 3000); // 3 seconds should be enough for animations to complete
}

// Function to set up testimonial scrolling
function setupTestimonialScrolling() {
    const scrollContainer = document.querySelector('.alumni-testimonials-container');
    const leftArrow = document.querySelector('.scroll-left');
    const rightArrow = document.querySelector('.scroll-right');
    const testimonialsSection = document.querySelector('.alumni-testimonials-section');

    if (!scrollContainer || !leftArrow || !rightArrow) return;

    // Calculate the scroll amount based on card width with improved precision
    const getScrollAmount = () => {
        const firstCard = scrollContainer.querySelector('.alumni-testimonial-card');
        if (firstCard) {
            // Get precise measurements including margins and gaps
            const cardStyle = window.getComputedStyle(firstCard);
            const cardWidth = firstCard.offsetWidth;
            const marginRight = parseInt(cardStyle.marginRight, 10) || 0;
            const marginLeft = parseInt(cardStyle.marginLeft, 10) || 0;
            return cardWidth + marginRight + marginLeft;
        }
        return 300; // Default fallback
    };

    // Add visual feedback for scrolling
    const addScrollingEffect = (direction = 'right') => {
        if (testimonialsSection) {
            testimonialsSection.classList.add('scrolling');
            testimonialsSection.classList.add(`scrolling-${direction}`);
            setTimeout(() => {
                testimonialsSection.classList.remove('scrolling');
                testimonialsSection.classList.remove(`scrolling-${direction}`);
            }, 600);
        }
    };

    // Function to check if scroll arrows should be visible
    function updateScrollArrows() {
        if (scrollContainer.scrollLeft <= 0) {
            leftArrow.style.opacity = '0.4';
            leftArrow.style.pointerEvents = 'none';
        } else {
            leftArrow.style.opacity = '0.8';
            leftArrow.style.pointerEvents = 'auto';
        }

        if (scrollContainer.scrollLeft + scrollContainer.clientWidth >= scrollContainer.scrollWidth - 10) {
            rightArrow.style.opacity = '0.4';
            rightArrow.style.pointerEvents = 'none';
        } else {
            rightArrow.style.opacity = '0.8';
            rightArrow.style.pointerEvents = 'auto';
        }
    }

    // Scroll left on left arrow click with better precision and smooth animation
    leftArrow.addEventListener('click', (e) => {
        e.preventDefault();
        const amount = getScrollAmount();
        addScrollingEffect('left');

        scrollContainer.scrollBy({
            left: -amount,
            behavior: 'smooth'
        });
    });

    // Scroll right on right arrow click with better precision and smooth animation
    rightArrow.addEventListener('click', (e) => {
        e.preventDefault();
        const amount = getScrollAmount();
        addScrollingEffect('right');

        scrollContainer.scrollBy({
            left: amount,
            behavior: 'smooth'
        });
    });

    // Add keyboard navigation support with improved visual feedback
    document.addEventListener('keydown', (e) => {
        // Only handle keyboard navigation when focus is on body or the testimonials section
        if (testimonialsSection &&
            (document.activeElement === document.body ||
                testimonialsSection.contains(document.activeElement))) {
            if (e.key === 'ArrowLeft') {
                e.preventDefault();
                addScrollingEffect('left');
                scrollContainer.scrollBy({
                    left: -getScrollAmount(),
                    behavior: 'smooth'
                });
            } else if (e.key === 'ArrowRight') {
                e.preventDefault();
                addScrollingEffect('right');
                scrollContainer.scrollBy({
                    left: getScrollAmount(),
                    behavior: 'smooth'
                });
            }
        }
    });

    // Update arrows when scrolling
    scrollContainer.addEventListener('scroll', updateScrollArrows); // Disabled mouse wheel support - using arrow buttons only

    // Initialize arrow states
    setTimeout(updateScrollArrows, 300);

    // Add focus effect when hovering cards to improve interactivity
    const cards = document.querySelectorAll('.alumni-testimonial-card');
    cards.forEach((card) => {
        card.addEventListener('mouseenter', () => {
            cards.forEach(c => c.classList.remove('focus'));
            card.classList.add('focus');
        });
    });

    scrollContainer.addEventListener('mouseleave', () => {
        cards.forEach(c => c.classList.remove('focus'));
    });
}

// Function to enable touch swipe for horizontal scrolling - modified to only use arrow buttons
function enableTestimonialTouchScroll() {
    const scrollContainer = document.querySelector('.alumni-testimonials-container');
    if (!scrollContainer) return;

    // Remove grab cursor style since we're not allowing direct scroll interaction
    scrollContainer.style.cursor = 'default';
} // Removed indicator for scrollability - using arrow buttons only
}
